- name: "Create a new user"
  tags: [api, users, create]
  request:
    method: POST
    url: "/api/users"
    json:
      name: "John Doe"
      email: "john@example.com"
  expect:
    - status: 201
      json:
        structure:
          id: null
          name: string
          email: string
        content:
          name: "John Doe"
          email: "john@example.com"
  store:
    user_id: "{{ response.body.id }}"
    user_email: "{{ response.body.email }}"

- name: "Fetch the created user"
  tags: [api, users, read]
  request:
    method: GET
    url: "/api/users/{{ user_id }}"
  expect:
    - status: 200
      json:
        id: "{{ user_id }}"
        email: "{{ user_email }}"

- name: "Update user information"
  tags: [api, users, update]
  request:
    method: PATCH
    url: "/api/users/{{ user_id }}"
    json:
      name: "Jane Doe"
  expect:
    - status: 200
      json:
        name: "Jane Doe"

- name: "Delete the user"
  tags: [api, users, delete, cleanup]
  request:
    method: DELETE
    url: "/api/users/{{ user_id }}"
  expect:
    - status: 204
