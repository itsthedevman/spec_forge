- hooks:
    - before_file: setup_database
    - after_file: cleanup_database

- name: "Create user with step hooks"
  hooks:
    - before_each: log_request
    - before_each:
        name: set_context
        arguments:
          level: debug
          verbose: true
    - after_each: verify_cleanup
  request:
    method: POST
    url: "/api/users"
    json:
      name: "Test User"
  expect:
    - status: 201
  store:
    user_id: "{{ response.body.id }}"

- name: "Fetch user"
  request:
    method: GET
    url: "/api/users/{{ user_id }}"
  expect:
    - status: 200
